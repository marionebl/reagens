<!--lint disable no-html-->
# reagens

React projects in legacy environments face the difficulty
to handle markup generated by incompatible backend technologies.

Although there are a number of projects
to introduce server-side React rendering
for various platforms<sup id="a1">[1](#f1)</sup>,
it might be impossible or
unfeasible to incorporate them in a given setup.

The easiest way to mount React components in this type of system
is to provide the data used by the server-side renderer to the
frontend program<sup id="a2">[2](#f2)</sup>.
The possible divergences between data structures used by server-side
renderers and the assumptions made in components to mount are endless.
Additionally this approach requires adaptions to the server
side code which might be unfeasible due to technical restrictions,
lack of knowledge or financial reasons.

reagens tries to bridge the gap between legacy backends
and modern frontends where retro-fitting of React compatibility
layers and data-passing is impossible by enabling developers to
mount their React components on server-rendered markup.


## Concept

This missing link for React components to mount in legacy environments is
the missing data for initial renderings.
The only possible source for the needed data is the markup the components 
should be mounted on. This leads us to the following tasks:

### Build time
*  Extract information about side effects and permutations from JSX
*  Use propTypes to get type casting information if available
*  Attach information as `reagensTypes` to Component declaration
*  Attach references to other components as `reagensDependencies` to Component declaration

### Run time
*  Parse the DOM structure to mount a React component on
*  Extract information from DOM structure
*  Use `reagensTypes` to assemble initial data from DOM structure

### Limitations
*  In its most naive implementation this works only for direct prop passing
*  Mutations on passed props must be idempotent

## API
```
const props = reagens(HTMLElement, ReactComponent);
ReactDOM.render(<ReactComponent />, HTMLElement);
```

---

<b id="f1">1  Server-side React integrations[↩](#a1)</b>

*   [Java](https://github.com/KnisterPeter/jreact)
*   [Python](https://github.com/markfinger/python-react)
*   [PHP](https://github.com/reactjs/react-php-v8js)
*   [.NET](https://github.com/reactjs/React.NET)

<b id="f2">2  Passing mount data to the client[↩](#a2)</b>

```html
<ul id="legacy-markup" data-mount-point="list">
  <li>
    Lorem
  </li>
  <li>
    Ipsum
  </li>
</ul>
<script data-mount-data="list" type="application/json">
  {
    id: "legacy-markup",
    items: [
      "Lorem",
      "Ipsum"
    ]
  }
</script>
<script>
  var List = React.createClass({
    render() {
      return React.createElement('ul', this.props,
        this.props.items.map(function(item){
          return  React.createElement('li', {}, item);
        })
      );
    }
  });
  
  var mountPointElement = document.querySelector('[data-mount-point]');
  var mountDataElement = document.querySelector('[data-mount-data]')
  var mountData = JSON.parse(mountDataElement.textContent);

  ReactDOM.render(React.createElement(List, mountData), mountPointElement);
</script>
```
